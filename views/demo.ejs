<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ACNLP Demo</title>
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link type="text/css" href="/stylesheets/demo.css" rel="stylesheet">
    <script src="http://cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>
    <script src="http://cdn.bootcss.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/javascripts/highcharts.js"></script>
</head>

<body>
    <!--页眉-->
    <div class="head-wrap">
        <div class="head">
            <div class="head-brand"></div>
            <ul class="nav head-nav">
                <li><a href="/">首页</a></li>
                <li><a href="/api">文档</a></li>
                <li class="active"><a href="#">演示</a></li>
                <li><a href="/demovv">viva入口</a></li>
                <li><a href="http://autobot.acnlp.com:3000">AutoBot</a></li>
            </ul>
        </div>
    </div>
    <!--容器-->
    <div class="container">
        <!--提交区-->
        <div class="submit_area">
            <textarea class="textarea"></textarea>
            <div class="btn btn-danger danger_btn">清除</div>
            <div class="btn btn-primary submit_btn">提交</div>
        </div>
        <!--分析区-->
        <div class="analysis">
            <div class="analysis_nav">
                <div class="l1">ACNLP解析结果</div>
                <div class="l2 clicked">精确分词</div>
                <div class="l2">搜索引擎分词</div>
                <div class="l2">关键词提取</div>
                <div class="l2">词性标记</div>
                <div class="l2">情感分析</div>
                <div class="l2">相似性</div>
            </div>
            <div class="analysis_result_border">
                <div class="analysis_result"></div>
            </div>
        </div>
    </div>
    <!--页脚-->
    <div class="blog-footer">
        <p>ACNLP by 49 Team</p>
        <p><a href="#">置顶</a></p>
    </div>
</body>
<script>
    $(document).ready(function() {

        'user strict';

        // ajax字典
        var methodDict = {
            '精确分词': '/exactCut/',
            '搜索引擎分词': '/searchCut/',
            '关键词提取': '/kwAnalyse/',
            '词性标记': '/wordFlag/',
            '情感分析': '/sentiments/',
            '相似性': '/similar/',
        };

        // 回调字典
        var processDict = {
            '/exactCut/': exactCutResult,
            '/searchCut/': searchCutResult,
            '/kwAnalyse/': kwAnalyseResult,
            '/wordFlag/': wordFlagResult,
            '/sentiments/': sentimentsResult
        };

        // 提交按钮点击事件
        $('.submit_btn').click(function () {
            $('.analysis_nav .clicked').removeClass('clicked');
            $('.analysis_nav .l2').first().addClass('clicked');
            $.get('/exactCut/' + $('.textarea').val(), exactCutResult);
        });

        // 导航切换触发点击事件
        $('.analysis_nav').on('click', '.l2', function () {
            $('.analysis_nav .clicked').removeClass('clicked');
            $(this).addClass('clicked');
            // user input
            var value = $('.textarea').val();
            // key of methodDict
            var now = $('.analysis_nav .clicked').text();
            // method for ajax call
            var method = methodDict[now] || 'exactCut';
            // method for process result
            var process = processDict[method];
            if (now == '相似性') {
                var analysisResult = $('.analysis_result');
                analysisResult.text('');
                analysisResult.append('<div class="check_similar">点击查看相似性</div><div class="itemS"><span class="span1">文档排行</span><span class="span2">相似性</span></div>');
            } else {
                // ajax call
                $.get(method + value, process);
            }
        });

        // 相似性分析
        $('.analysis_result').on('click', '.check_similar', function () {
            if ($('.check_similar').text() == '查询很漫长,请等候...') return false;
            $('.check_similar').text('查询很漫长,请等候...');
            var value = $('.textarea').val();
            $.get('/similar/' + value, similarResult);
        });

        // 相似文章展示
        $('.analysis_result').on('click', '.item .simiNO', function () {
            $.get('/atc/' + $(this).text(), function(data) {
                alert(data.data);
            });
        });

        // 初始化页面
        var text = '<%= text %>';
        $('.textarea').val(text);
        $('.submit_btn').trigger('click');
        Highcharts.setOptions({ global: { useUTC: false } });

        // 精确分词-回调
        function exactCutResult(result) {
            var analysisResult = $('.analysis_result');
            analysisResult.text('');
            for (var i = 0, k = result.wordsList.length - 1; i < k; i+=1) {
                analysisResult.append(result.wordsList[i] + '&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;');
            }
            analysisResult.append(result.wordsList[k]);
        };

        // 搜索引擎分词-回调
        function searchCutResult(result) {
            var analysisResult = $('.analysis_result');
            analysisResult.text('');
            for (var i = 0, k = result.wordsList.length - 1; i < k; i+=1) {
                analysisResult.append(result.wordsList[i] + '&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;');
            }
            analysisResult.append(result.wordsList[k]);
        };

        // 关键词提取-回调
        function kwAnalyseResult(result) {
            var analysisResult = $('.analysis_result');
            analysisResult.text('');
            analysisResult.append('<div class="itemS"><span class="span1">关键词</span><span class="span2">权重</span></div>');
            for (var i = 0, k = result.rankList.length; i < k; i+=1) {
                var item = $('<div class="item"><span>' + result.rankList[i]['word'] + '</span><span>' + result.rankList[i]['weight'] + '</span></div>');
                item.appendTo(analysisResult);
            }
        };

        // 词性标记-回调
        function wordFlagResult(result) {
            var analysisResult = $('.analysis_result');
            analysisResult.text('');
            analysisResult.append('<div class="itemS"><span class="span1">分词</span><span class="span2">词性</span></div>');
            for (var i = 0, k = result.flagsList.length; i < k; i+=1) {
                var item = $('<div class="item"><span>' + result.flagsList[i]['word'] + '</span><span>' + result.flagsList[i]['flag'] + '</span></div>');
                item.appendTo(analysisResult);
            }
        };

        // 情感分析-回调
        function sentimentsResult(result) {
            sentiments = parseFloat(result.sentiments[0]).toFixed(2);
            mlsentiments = parseFloat(result.sentiments[1]).toFixed(2);
            $('.analysis_result').highcharts({
                chart: {
                    backgroundColor: '#f6f6f6',
                    renderTo: 'container',
                    type: 'pie'
                },
                title: {
                    text: '情感分析(左为基于机器学习：样本过少准确度有待提高，右为基于句法分析)'
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                },
                plotOptions: {
                    pie: {
                        size:'100%',
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: { enabled: true, color: '#000000', connectorColor: '#000000', format: '<b>{point.name}</b>: {point.percentage:.1f} %' },
                        showInLegend: true
                    }
                },
                series: [
                    {
                        name: '基于机器学习的情感分析',
                        center: ['20%'],
                        data: [{name:'正面',y:parseFloat(mlsentiments)},{name:'负面',y:(1 - parseFloat(mlsentiments))}]
                    },
                    {
                        name: '情感倾向',
                        center: ['80%'],
                        data: [{name:'正面',y:parseFloat(sentiments)},{name:'负面',y:(1 - parseFloat(sentiments))}]
                    }
                ]
            });
        };

        // 相似性-回调
        function similarResult(result) {
            var analysisResult = $('.analysis_result');
            $('.check_similar').text('点击查看相似性');
            for (var i = 0, k = result.similarNO.length; i < k; i+=1) {
                var item = $('<div class="item"><span class="simiNO">' + parseInt(result.similarNO[i]) + '</span><span>' + result.similarQZ[i] + '</span></div>');
                analysisResult.append(item);
            }
        };

    });
</script>
</html>
